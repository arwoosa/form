syntax = "proto3";

package form.service;

option go_package = "github.com/arwoosa/form-service/gen/pb/form";

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";
import "proto/common.proto";
import "validate/validate.proto";

// FormService - Manages form templates and forms.
service FormService {
    // Creates a new form template
    rpc CreateFormTemplate(CreateFormTemplateRequest) returns (CreateFormTemplateResponse) {
        option (google.api.http) = {
            post: "/form_templates"
            body: "*"
        };
    }
    
    // Lists form templates with pagination
    rpc ListFormTemplates(ListFormTemplatesRequest) returns (ListFormTemplatesResponse) {
        option (google.api.http) = {
            get: "/form_templates"
        };
    }
    
    // Gets a single form template by ID
    rpc GetFormTemplate(form.common.ID) returns (FormTemplate) {
        option (google.api.http) = {
            get: "/form_templates/{id}"
        };
    }
    
    // Updates an existing form template
    rpc UpdateFormTemplate(UpdateFormTemplateRequest) returns (FormTemplate) {
        option (google.api.http) = {
            put: "/form_templates/{id}"
            body: "*"
        };
    }
    
    // Deletes a form template by ID
    rpc DeleteFormTemplate(form.common.ID) returns (google.protobuf.Empty) {
        option (google.api.http) = {
            delete: "/form_templates/{id}"
        };
    }
    
    // Duplicates an existing form template
    rpc DuplicateFormTemplate(DuplicateFormTemplateRequest) returns (DuplicateFormTemplateResponse) {
        option (google.api.http) = {
            post: "/form_templates/{id}/duplicate"
            body: "*"
        };
    }
    
    // Creates a new form
    rpc CreateForm(CreateFormRequest) returns (CreateFormResponse) {
        option (google.api.http) = {
            post: "/forms"
            body: "*"
        };
    }
    
    // Lists forms with pagination
    rpc ListForms(ListFormsRequest) returns (ListFormsResponse) {
        option (google.api.http) = {
            get: "/forms"
        };
    }
    
    // Gets a single form by ID
    rpc GetForm(form.common.ID) returns (Form) {
        option (google.api.http) = {
            get: "/forms/{id}"
        };
    }
    
    // Updates an existing form
    rpc UpdateForm(UpdateFormRequest) returns (Form) {
        option (google.api.http) = {
            put: "/forms/{id}"
            body: "*"
        };
    }
    
    // Deletes a form by ID
    rpc DeleteForm(form.common.ID) returns (google.protobuf.Empty) {
        option (google.api.http) = {
            delete: "/forms/{id}"
        };
    }
}

// Form Template Messages
message FormTemplate {
    string id = 1;
    string name = 2;
    string merchant_id = 3;
    string description = 4;
    google.protobuf.Struct schema = 5;    // JSON Schema defining data structure and validation rules
    google.protobuf.Struct uischema = 6;  // UI Schema defining form layout and appearance
    google.protobuf.Timestamp created_at = 7;
    string created_by = 8;
    google.protobuf.Timestamp updated_at = 9;
    string updated_by = 10;
}

message CreateFormTemplateRequest {
    string name = 1 [(validate.rules).string.min_len = 1];
    string description = 2;
    google.protobuf.Struct schema = 3;
    google.protobuf.Struct uischema = 4;
}

message CreateFormTemplateResponse {
    FormTemplate template = 1;
}

message ListFormTemplatesRequest {
    int32 page = 1 [(validate.rules).int32.gte = 1];
    int32 page_size = 2 [(validate.rules).int32 = {gte: 1, lte: 100}];
}

message ListFormTemplatesResponse {
    repeated FormTemplate templates = 1;
    form.common.Pagination pagination = 2;
}

message UpdateFormTemplateRequest {
    string id = 1 [(validate.rules).string.min_len = 1];
    string name = 2 [(validate.rules).string.min_len = 1];
    string description = 3;
    google.protobuf.Struct schema = 4;
    google.protobuf.Struct uischema = 5;
}


message DuplicateFormTemplateRequest {
    string id = 1 [(validate.rules).string.min_len = 1];
    string name = 2 [(validate.rules).string.min_len = 1];
}

message DuplicateFormTemplateResponse {
    FormTemplate template = 1;
}

// Form Messages
message Form {
    string id = 1;
    string name = 2;
    string event_id = 3;
    string merchant_id = 4;
    string description = 6;
    google.protobuf.Struct schema = 7;    // JSON Schema defining data structure and validation rules
    google.protobuf.Struct uischema = 8;  // UI Schema defining form layout and appearance
    google.protobuf.Timestamp created_at = 9;
    string created_by = 10;
    google.protobuf.Timestamp updated_at = 11;
    string updated_by = 12;
}

message CreateFormRequest {
    string name = 1 [(validate.rules).string.min_len = 1];
    string event_id = 2 [(validate.rules).string.min_len = 1]; // required
    string description = 4;
    google.protobuf.Struct schema = 5;
    google.protobuf.Struct uischema = 6;
}

message CreateFormResponse {
    Form form = 1;
}

message ListFormsRequest {
    int32 page = 1 [(validate.rules).int32.gte = 1];
    int32 page_size = 2 [(validate.rules).int32 = {gte: 1, lte: 100}];
    string event_id = 3;    // Optional filter by event
}

message ListFormsResponse {
    repeated Form forms = 1;
    form.common.Pagination pagination = 2;
}


message UpdateFormRequest {
    string id = 1 [(validate.rules).string.min_len = 1];
    string name = 2 [(validate.rules).string.min_len = 1];
    string description = 5;
    google.protobuf.Struct schema = 6;
    google.protobuf.Struct uischema = 7;
}
